<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">В последнее время часто встречал вопросы о</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">получении данных с сайта</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> на </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">С++</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, поэтому решил написать статью, посвященную этой теме.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">В качестве примера статьи рассмотрена задача получения бесплатных проектов с одного фриланс-сайта</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;"> [1]</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">. На этом сайте, есть страница со списком проектов, на которой есть их (проектов) частичное описание и ссылка на страницу проекта, но наша задача — получить полное описание (оно есть на странице проекта).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-weight:600; color:#333333; background-color:#000000;">В статье описаны:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Georgia,Bitstream Charter,serif'; font-weight:600; color:#333333;"></p>
<ul type="square" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">шаблон проектирования «поставщик/потребитель» (producer/consumer pattern);</span></li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">средства библиотеки <span style=" font-style:italic;">Qt5</span>, позволяющие получать и обрабатывать информацию, размещенную на сайтах (<span style=" font-style:italic;">QNetworkAccessManager</span>);</li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">создание потоков при помощи <span style=" font-style:italic;">QThread</span>;</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">реализация шаблона </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">producer/consumer </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">в задаче получения и обработки веб-страниц.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-size:x-large; color:#000000; background-color:#ffffff;">Шаблон проектирования «поставщик/потребитель»</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Georgia,Bitstream Charter,serif'; font-size:x-large; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Шаблон «поставщик/потребитель»</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> — шаблон параллельного программирования, нем принимают участие:</span></p>
<ul type="square" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">поставщик</span> — объект, генерирующий, поставляющий данные (задачи) для обработки;</li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">потребитель</span> — объект, обрабатывающий данные, полученные от поставщика;</li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">задача</span> — данные, передаваемые между поставщиком и потребителем;</li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:24px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">очередь задач</span> — буфер, через который взаимодействуют поставщики и потребители.</li></ul>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">На каждую задачу можно было бы создать по отдельному потребителю (потоку), однако, это эффективное решение — лучше, количество потоков должно совпадать с числом ядер процессора. Эту проблему и решает</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">шаблон producer/consumer.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Суть шаблона заключается в том, что каждый поставщик и потребитель работает в отдельном потоке. Поставщики помещают задачи в очередь, а не занятые потребители вытаскивают их и выполняют. Очень схематично это показано на</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">рис.1.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image669225157.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Реализация может быть самой различной, например, может не выделяться явно класс «задача». Возможны вариации на тему «очереди» — это может быть как объект, работающий в отдельном потоке, так и очередь в разделяемой памяти, охраняемая мьютексом.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">В некоторых реализациях менеджер может управлять последовательностью выполнения задач, например, если они имеют приоритеты или задачи связаны между собой. В этом случае менеджер хранит информацию не только о задачах, но и о потребителях.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-weight:600; color:#333333; background-color:#000000;">Родственные паттерны. </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">Если мы перестанем задумываться откуда поступают данные (забудем о поставщиках) — то придем к шаблону </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Thread Pool (пул потоков). </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">Если в пуле потоков будет лишь один поток — шаблон будет называться </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Worker Thread</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> (</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">рабочий поток</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">).</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-size:x-large; color:#000000; background-color:#ffffff;">Загрузка страницы</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Georgia,Bitstream Charter,serif'; font-size:x-large; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Для загрузки страницы в</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Qt4</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> использовался класс </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QHttp</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, однако, он готовится к удалению и в</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Qt5</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> оставлен для совместимости в отдельном модуле — его использовать сейчас не стоит и мы его не коснёмся.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Загрузку страниц в</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Qt</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, в принципе, можно производить с помощью классов </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QWebView</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> и</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QWebPage</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">. Оба класса очень объёмны и предназначены для отрисовки содержимого страницы — первый из них представляет собой почти полноценный веб-браузер. Эти классы могут быть полезны и в других случаях (когда отрисовка не требуется), т.к. представляют страницу в виде</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">DOM (Document Object Model)</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, позволяет выполнить </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">JavaScript,</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> размещенный на странице и еще много всего. В связи с тем, что их основной функционал в нашем случае не нужен — не будем ими пользоваться (тем более эти классы связаны с </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">GUI</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, поэтому не могут работать в отдельном </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">потоке</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">).</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Для загрузки страниц в</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Qt5</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> используется класс </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QNetworkAccessManager, </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">в частности, он позволяет отправлять </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">POST- и GET-запросы</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">. Помимо </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QNetworkAccessManager</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> используются классы </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QNetworkRequest</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> (запрос к сайту) и </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QNetworkReply</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> (ответ сервера).</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Пример запроса страницы приведен на листинг 1.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:-1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">листинг 1 пример запроса страницы</span></p>
<table border="0" style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:-1px;" cellspacing="0" cellpadding="0">
<tr>
<td bgcolor="#ffffff" style=" padding-left:24; padding-right:24; padding-top:6; padding-bottom:6;">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">01</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">02</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">03</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">04</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">05</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">06</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">07</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">08</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">09</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">10</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">11</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">12</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">13</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">14</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">15</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">16</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">17</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">18</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">19</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">20</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">21</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">22</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">23</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">24</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">25</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">26</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">27</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">28</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">29</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">30</span></pre></td>
<td bgcolor="#ffffff" style=" padding-left:24; padding-right:24; padding-top:6; padding-bottom:6;">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">class</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">PageHandler : </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">public</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QObject {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#3f5fbf;">//...</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">public</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">:</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">explicit</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">PageHandler(QObject *parent = 0);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">public</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">slots:</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">void</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">on_page(QObject*, TaskType, QString);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#3f5fbf;">//!&lt; страница запрошена</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">private</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">slots:</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">void</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">on_load(QNetworkReply*);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#3f5fbf;">//!&lt; обработка сигнала finished QNetworkAccessManager</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">protected</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">:</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QNetworkAccessManager *m_nam;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#3f5fbf;">//!&lt; менеджер загрузки страниц</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#3f5fbf;">//...</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">};</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">PageHandler::PageHandler(QObject *parent) :</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">     </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QObject(parent), m_nam(</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">new</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QNetworkAccessManager(</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">this</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">)) {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">     </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">connect(m_nam, SIGNAL(finished(QNetworkReply*)), SLOT(on_load(QNetworkReply*)));</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">}</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">void</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">PageHandler::on_load(QNetworkReply *reply) {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">     </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#3f5fbf;">// обработка ответа сервера</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">}</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">void</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">PageHandler::on_page(QString url) {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">     </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QNetworkRequest req(url);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">     </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">req.setHeader(QNetworkRequest::ContentTypeHeader, QVariant(</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;text/plain&quot;</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">));</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">     </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">m_nam-&gt;post(req, </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;&quot;</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">}</span></pre></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">В 27 строке создается экземпляр класса</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QNetworkRequest</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, в 29 строке — отправляется </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">POST-запрос</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">. Метод </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">post(</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">) возвращает указатель на </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QNetworkReply</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, который будет содержать ответ сервера после того, как </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QNetworkAccessManager</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> выработает сигнал </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">finished(QNetworkReply*)</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">. Результат вызова </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">post()</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> можно не сохранять, т.к. сигнал </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">finished(QNetworkReply*) </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">несет тот же указатель. Обработка страницы в примере осуществляется в слоте </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">on_load(QNetworkReply *reply)</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, с которым в 19 строке соединен соответствующий сигнал.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">При обработке страницы удобно использовать</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">регулярные выражения (QRegExp), </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">но в нашей простой задаче это будет излишним. </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QNetworkReply::readAll()</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> возвращает содержимое страницы в виде </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QByteArray.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QByteArray</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> позволяет найти первое вхождение подстроки при помощи метода </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">indexOf(),</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">который гораздо проще (в реализации) </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">регулярных выражений</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> и в нашем случае гораздо эффективнее.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">На листинг 2 приведен фрагмент слота</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">on_load</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, в котором осуществляется поиск ссылок на бесплатные проекты. В методе </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">on_load()</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> намеренно написан некрасивый </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">switch</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> — на этом примере я надеюсь в будущем описать делегирование в </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">C++</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, а именно, </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">шаблон проектирования «Состояние» (State).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:-1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">листинг 2 пример обработки страницы</span></p>
<table border="0" style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:-1px;" cellspacing="0" cellpadding="0">
<tr>
<td bgcolor="#ffffff" style=" padding-left:24; padding-right:24; padding-top:6; padding-bottom:6;">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">01</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">02</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">03</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">04</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">05</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">06</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">07</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">08</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">09</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">10</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">11</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">12</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">13</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">14</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">15</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">16</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">17</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">18</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">19</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">20</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">21</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">22</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">23</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">24</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">25</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">26</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">27</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">28</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">29</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">30</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">31</span></pre></td>
<td bgcolor="#ffffff" style=" padding-left:24; padding-right:24; padding-top:6; padding-bottom:6;">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">void</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">PageHandler::on_load(QNetworkReply *reply) {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QByteArray buff = reply-&gt;readAll();</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">qint16 idx = 0, start = -1, finish = -1;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">switch</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">(m_pageType) {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">case</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">TaskType::External: {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QString</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">patProjStart = </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;&lt;div class=\&quot;proj public\&quot; &gt;&quot;</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">patAddrStart = </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;&lt;a class=\&quot;ptitle\&quot; href=\&quot;&quot;</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">patAddrFinish = </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;\&quot;&quot;</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">for</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">(;;) {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">idx = buff.indexOf(patProjStart, idx);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">if</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">(idx &lt; 0) </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">break</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">idx = idx + patProjStart.length();</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">idx = buff.indexOf(patAddrStart, idx);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">Q_ASSERT(idx &gt; 0);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">idx = start = idx + patAddrStart.length();</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">idx = buff.indexOf(patAddrFinish, idx);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">Q_ASSERT(idx &gt; 0);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">finish = idx;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">      </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#3f5fbf;">//qDebug() &lt;&lt; m_host + buff.mid(start, finish - start);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">}</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">} </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">break</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#3f5fbf;">// ...</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">}</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#3f5fbf;">//...</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">delete</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">reply;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">}</span></pre></td></tr></table>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Обратите внимание на 31 строку — если из под ответа сервера не освободить память в обработчике сигнала</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">finished(QNetworkReply*)</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> — произойдет утечка (ведь указатель мы нигде не сохраняли).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-size:x-large; color:#000000; background-color:#ffffff;">Потоки в Qt</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Georgia,Bitstream Charter,serif'; font-size:x-large; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Для работы с потоками в</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Qt</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> применяется класс </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QThread</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">, есть </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">2</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> варианта порождения потоков с его помощью:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">порождение наследника от <span style=" font-style:italic;">QThread</span>, содержащего слот <span style=" font-style:italic;">run()</span>. При запуске потока методом<span style=" font-style:italic;">QThread::start()</span> начнется выполнение кода слота <span style=" font-style:italic;">run();</span></li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:24px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">создание экземпляра класса <span style=" font-style:italic;">QThread</span> и «перемещение» в него объекта, который должен работать в отдельном потоке. Перемещение осуществляется методом<span style=" font-style:italic;">QThread::moveToThread(), </span>а запуск потока — методом <span style=" font-style:italic;">QThread::start().</span></li></ol>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">В статье используется второй подход.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Отмечу, что в Qt потоки можно создавать и без использования</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QThread</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> напрямую — для этого существуют классы </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QtConcurrent</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> и </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QThreadPool,</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> описание которых не вошло в статью.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">На листинг 3 приведена главная функция программы, порождающая 5 потоков с экземплярами класса</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">PageHandler</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> — обработчиками страниц.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:-1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">листинг 3 главная функция - порождение потоков</span></p>
<table border="0" style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:-1px;" cellspacing="0" cellpadding="0">
<tr>
<td bgcolor="#ffffff" style=" padding-left:24; padding-right:24; padding-top:6; padding-bottom:6;">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">01</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">02</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">03</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">04</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">05</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">06</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">07</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">08</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">09</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">10</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">11</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">12</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">13</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">14</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">15</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">16</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">17</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">18</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">19</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">20</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">21</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">22</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">23</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">24</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">25</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">26</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">27</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">28</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">29</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">30</span></pre></td>
<td bgcolor="#ffffff" style=" padding-left:24; padding-right:24; padding-top:6; padding-bottom:6;">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#808080;">int</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">main(</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#808080;">int</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">argc, </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#808080;">char</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">**argv) {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QApplication a(argc, argv);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">qRegisterMetaType&lt;TaskType&gt;(</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;TaskType&quot;</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">ResultDriver driver(</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;results.txt&quot;</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">TaskManager manager;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">for</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">(</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#808080;">int</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">i = 0; i &lt; 5; ++i) {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QThread *handlerThread = </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">new</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QThread(&amp;manager);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">PageHandler *handler = </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">new</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">PageHandler(</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;</span><a href="http://freelance.ru/"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; text-decoration: underline; color:#2a00ff;">http://freelance.ru</span></a><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QObject::connect(handlerThread, SIGNAL(finished()),</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">                     </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">handler, SLOT(deleteLater()));</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QObject::connect(handler, SIGNAL(project(QString)),</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">                     </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">&amp;driver, SLOT(on_project(QString)));</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">handler-&gt;moveToThread(handlerThread);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">handlerThread-&gt;start();</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">manager.addHandler(handler, handlerThread);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">}</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QObject::connect(&amp;manager, SIGNAL(finished()), &amp;driver, SLOT(saveAll()));</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">QObject::connect(&amp;driver, SIGNAL(finished()), &amp;a, SLOT(quit()));</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">manager.addTask(TaskType::External, </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;</span><a href="http://freelance.ru/projects/?cat=4&amp;spec=108"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; text-decoration: underline; color:#2a00ff;">http://freelance.ru/projects/?cat=4&amp;spec=108</span></a><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#2a00ff;">&quot;</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333; background-color:#ffffff;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">return</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">a.exec();</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">}</span></pre></td></tr></table>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Я пока что не описывал из каких частей состоит наша программа, а теперь должен пояснить.</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">TaskManager</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> отвечает за хранение списка задач (</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Task</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">) по обработчикам </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">(PageHandler).</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">Каждый обработчик работает в отдельном потоке.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Потоки порождаются в</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">10</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">строке, </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">при этом в качестве родительского объекта у них указывается </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">менеджер задач</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> (при уничтожении менеджера будут убиты все потоки). Каждый объект соединяется с </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">менеджером</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> соответствующими сигналами и слотами (</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">строки 13-16</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">). В</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">18</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">строке</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> обработчик перемещается в отдельный поток, а в </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">19 строке</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> поток запускается.</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">При взаимодействии обработчиков с менеджером через механизм сигналов и слотов передаются задачи, т.к. они не являются стандартным типом</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Qt</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> — должны быть зарегистрированы вызовом</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">qRegisterMetaType</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> (</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">4 строка</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">).</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Для того, чтобы потоки корректно завершили работу необходим последовательный вызов методов</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QThread::quit()</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> и </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">QThread::wait() — </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">первый просит поток завершиться, а второй — ждет завершения. Остановкой потоков занимается </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">TaskManager, </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">поэтому помимо списка обработчиков он должен хранить список потоков. В </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">27 строке</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> метод </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">TaskManager</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">::</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">addtask())</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">принимает соответствующие указатели. На </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">листинг 4</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> приведен код остановки потоков.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:-1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">листинг 4 остановка потоков</span></p>
<table border="0" style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:-1px;" cellspacing="0" cellpadding="0">
<tr>
<td bgcolor="#ffffff" style=" padding-left:24; padding-right:24; padding-top:6; padding-bottom:6;">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">3</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">4</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">5</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#787878; background-color:#ffffff;">6</span></pre></td>
<td bgcolor="#ffffff" style=" padding-left:24; padding-right:24; padding-top:6; padding-bottom:6;">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">TaskManager::~TaskManager() {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">for</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">(QThread *</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">thread</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;"> </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">: m_threads) {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">thread</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">-&gt;quit();</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">    </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-weight:600; color:#7f0055;">thread</span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">-&gt;wait();</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#333333;">  </span><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">}</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; color:#000000;">}</span></pre></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-size:x-large; color:#000000; background-color:#ffffff;">Реализация</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Georgia,Bitstream Charter,serif'; font-size:x-large; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Достаточно грубо архитектура приложения показана на</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">рис. 2</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">. Стрелками показаны потоки данных, передаваемые между объектами программы. Ключевое отличие от</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;"> рис. 1</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> заключается в том, что поставщики данных, являются и потребителями.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image455055451.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Поставщики и потребители, вообще не являются экземплярами разных классов, они получают задачу и в зависимости от ее типа выполняют те или иные действия (в одной из следующих статей я покажу как сделать эту систему более гибкой и красивой за счет применения</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">шаблона проектирования «состояние» (State)</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">).</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Конфликтов при обращении исполнителей к очереди не возникает, т.к.  очередь обрабатывается в отдельном потоке. Потребители и поставщики могут посылать очереди сигналы, которые по умолчанию являются синхронными (</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">обработка синхронных сигналов</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> в </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">Qt</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> такова, что каждый объект имеет очередь сигналов, которые обрабатываются последовательно — гарантируется, что сигнал, принятый раньше будет обработан первым).</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Аналогичным образом происходит работа с файлом — писать в файл может лишь один объект — «обработчик результатов» (</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">рис.2</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;">). Если бы мы не ввели такой объект — потоки начали бы конкурировать за файл, пришлось бы вводить </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">мьютексы</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> (или что-то подобное).</span></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Я не буду приводить описания классов задачи, менеджера и обработчика результатов, т.к. они весьма тривиальны. Вместо этого прикреплю файл с проектом:</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><a href="http://pro-prof.com/wp-content/uploads/2013/09/flps.zip"><span style=" font-family:'Georgia,Bitstream Charter,serif'; text-decoration: underline; color:#999999; background-color:#000000;">Парсер freelance[Qt] (исходный код)</span></a></p>
<p style=" margin-top:0px; margin-bottom:24px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#ffffff;">Отмечу лишь то, что менеджер помимо указателя на поставщика/потребителя должен хранить его состояние — поэтому введен дополнительный класс</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> </span><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-style:italic; color:#333333; background-color:#000000;">TaskManagerHandler</span><span style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333;"> (состояние обработчика с точки зрения менеджера). Дело в том, что состояние обработчика может измениться, но менеджер не узнает об этом мгновенно — он изменит состояние лишь после получения соответствующего сигнала (и лишь после этого будет принимать решение о загрузке потока новыми задачами).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Bitstream Charter,serif'; font-size:x-large; color:#000000; background-color:#ffffff;">Список использованных источников</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Georgia,Bitstream Charter,serif'; font-size:x-large; color:#000000;"></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">сайт, проекты с которого парсим в этой статье / http://freelance.ru/;</li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">описание <span style=" font-style:italic;">шаблона «Поставщик/Потребитель»</span> на сайте <span style=" font-style:italic;">Intel</span> / http://software.intel.com/ru-ru/articles/producer-consumer;</li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание <span style=" font-style:italic;">шаблона проектирования «Worker Thread»</span> / http://ooad.asf.ru/Pattern.aspx?IdKat=7&amp;IdPat=60;</li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Короткое описание <span style=" font-style:italic;">шаблона проектирования «Thread Pool»</span> на сайте <span style=" font-style:italic;">Microsoft</span> / http://social.technet.microsoft.com/wiki/contents/articles/13245.thread-pool-design-pattern.aspx;</li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание шаблонов проектирования <span style=" font-style:italic;">«Пул потоков» и «Поставщик/Потребитель»</span> на сайте Корнелльского университета (престижный американский университет) / http://www.cs.cornell.edu/courses/cs3110/2010fa/lectures/lec18.html;</li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Одна из возможных реализаций шаблона <span style=" font-style:italic;">«Producer/Consumer»</span> с описанием / http://hashcode.ru/research/221526/многопоточность-имплементация-producer-consumer-pattern;</li>
<li style=" font-family:'Georgia,Bitstream Charter,serif'; color:#333333; background-color:#000000;" style=" margin-top:0px; margin-bottom:24px; margin-left:29px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://pro-prof.com/books"><span style=" text-decoration: underline; color:#999999;">Книги</span></a> раздела «проектирование».</li></ol>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p></body></html>